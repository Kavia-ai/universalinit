configure_environment:
  command: "flutter build apk --release --target-platform android-x64"
  working_directory: "{KAVIA_PROJECT_DIRECTORY}"

build_cmd:
  command: "flutter build apk --release --target-platform android-x64"
  working_directory: "{KAVIA_PROJECT_DIRECTORY}"

install_dependencies:
  command: "flutter pub get"
  working_directory: "{KAVIA_PROJECT_DIRECTORY}"
  
env:
  environment_initialized: true
  flutter_version: "3.29.1"
  dart_version: "3.6.1"

init_files: []

init_minimal: "Minimal Flutter application initialized"

run_tool:
  command: "flutter run"
  working_directory: "{KAVIA_PROJECT_DIRECTORY}"

test_tool:
  command: "flutter test"
  working_directory: "{KAVIA_PROJECT_DIRECTORY}"

init_style: ""

linter:
  script_content: |
    #!/bin/bash
    cd {KAVIA_PROJECT_DIRECTORY}
    flutter analyze

pre_processing:
  script: |
    #!/bin/bash
    set -e
    # Remove directory if exists to ensure clean creation
    rm -rf {KAVIA_TEMPLATE_PROJECT_NAME}
    # Create Flutter project with Android v2 embedding (default in Flutter 3+)
    flutter create --platforms=android --android-language kotlin --project-name {KAVIA_TEMPLATE_PROJECT_NAME} {KAVIA_TEMPLATE_PROJECT_NAME}

post_processing:
  script: |
    #!/bin/bash
    cd {KAVIA_PROJECT_DIRECTORY}
    touch .env
    # Set NDK version required by shared_preferences_android and sqflite_android
    # This prevents Gradle from downloading NDK during first build
    if [ -f "android/app/build.gradle.kts" ]; then
      sed -i '/namespace = /a\        ndkVersion = "27.0.12077973"' android/app/build.gradle.kts
    fi
    flutter pub get
